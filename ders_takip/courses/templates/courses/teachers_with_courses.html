{% extends "base.html" %}

{% block title %}
Öğretmen ve Ders Bilgileri
{% endblock title %}

{% block content %}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<style>
    .container {
        max-width: 100%;
        margin: auto;
        padding: 0 10px;
    }
    .card-header, .table thead th {
        background-color: rgb(97, 98, 99);
        color: white;
        font-size: 0.9rem;
        padding: 10px;
    }
    .teacher-card {
        margin-bottom: 15px;
        border: 1px solid rgb(55, 56, 57);
        border-radius: 8px;
        overflow: hidden;
        padding: 10px;
    }
    .course-card {
        margin-bottom: 10px;
        border: 1px solid #6c757d;
        border-radius: 6px;
        overflow: hidden;
        padding: 8px;
    }
    .document-table {
        margin-top: 8px;
    }
    .action-buttons {
        text-align: right;
        margin-top: 8px;
    }
    .action-buttons .btn {
        margin-left: 4px;
        padding: 5px 10px;
        font-size: 0.8rem;
    }
    h1 {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: #333;
        text-align: center;
    }
    h5 {
        font-size: 1rem;
        margin-bottom: 10px;
        color: #333;
    }
    h6 {
        font-size: 0.9rem;
        margin-bottom: 8px;
        color: white;
    }
    p {
        font-size: 0.9rem;
        margin-bottom: 6px;
    }
    table {
        font-size: 0.85rem;
    }
    .table th, .table td {
        padding: 6px;
    }
    .custom-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1050;
    }
    .custom-modal-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        text-align: center;
        margin: 15% auto;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    .custom-modal .btn {
        margin: 10px 5px;
    }
</style>

<script>
    function showCustomModal() {
        document.getElementById('customModal').style.display = 'block';
    }

    function hideCustomModal() {
        document.getElementById('customModal').style.display = 'none';
    }

    function showDocumentDeleteModal(documentId) {
        const modal = document.getElementById('documentDeleteModal');
        modal.style.display = 'block';
        modal.querySelector('#confirmDelete').setAttribute('data-document-id', documentId);
    }

    function hideDocumentDeleteModal() {
        document.getElementById('documentDeleteModal').style.display = 'none';
    }

    function confirmDocumentDelete() {
        const documentId = document.getElementById('confirmDelete').getAttribute('data-document-id');
        // Burada belge silme işlemi için gerekli AJAX isteğini gönderin
        console.log(`Belge siliniyor: ${documentId}`);
        hideDocumentDeleteModal();
    }
</script>

<div class="container mt-5">
    <h1>Öğretmenler ve Dersler</h1>

    {% for teacher in teachers %}
        <div class="card teacher-card">
            <div class="card-header text-center">
                <h4>{{ teacher.name }} {{ teacher.surname }}</h4>
            </div>
            <div class="card-body">
                {% if teacher.courses %}
                    <h5>Dersler:</h5>
                    {% for course in teacher.courses %}
                        <div class="card course-card">
                            <div class="card-header">
                                <h6>{{ course.name }}</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Durum:</strong> {{ course.statu }}</p>
                                <p><strong>Açıklama:</strong> {{ course.description }}</p>
                                <p><strong>Oluşturulma Tarihi:</strong> {{ course.created_at }}</p>

                                <div class="document-table">
                                    <h6>Belgeler:</h6>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Belge Kategorisi</th>
                                                <th>Belge Adı</th>
                                                <th>Bağlantı</th>
                                                <th>İşlem</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for document in course.files %}
                                                <tr>
                                                    <td>{{ document.category }}</td>
                                                    <td>{{ document.belge_adi }}</td>
                                                    <td><a href="{{ document.belge_url }}" target="_blank">Görüntüle</a></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-danger" onclick="showDocumentDeleteModal('{{ document.id }}');">Sil</button>
                                                    </td>
                                                </tr>
                                            {% empty %}
                                                <tr>
                                                    <td colspan="4" class="text-center">Henüz belge eklenmemiş.</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-success">Arşivle</button>
                                    <button class="btn btn-sm btn-danger" onclick="showCustomModal();">Bu dersi sil</button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-center">Henüz ders eklenmemiş.</p>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>

<!-- Ders Sil Modal -->
<div id="customModal" class="custom-modal">
    <div class="custom-modal-content">
        <h5>Bu dersi silmek istediğinize emin misiniz?</h5>
        <button class="btn btn-sm btn-success" onclick="hideCustomModal();">Evet</button>
        <button class="btn btn-sm btn-danger" onclick="hideCustomModal();">Hayır</button>
    </div>
</div>

<!-- Belge Sil Modal -->
<div id="documentDeleteModal" class="custom-modal">
    <div class="custom-modal-content">
        <h5>Bu belgeyi silmek istediğinize emin misiniz?</h5>
        <button id="confirmDelete" class="btn btn-sm btn-success" onclick="confirmDocumentDelete();">Evet</button>
        <button class="btn btn-sm btn-danger" onclick="hideDocumentDeleteModal();">Hayır</button>
    </div>
</div>

{% endblock content %}
